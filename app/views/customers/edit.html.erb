

<div class="container">
  <h3>Customer Master</h3>
  <div class="row">
    <div class="panel panel-default">
      <div class="panel-heading" style="font-weight:bold;">1. Account Profile</div>
      <div class="panel-body">
        <%= form_for(@customer, :html => {class: "form-horizontal", role: "form"}) do |f| %>
          
          <div class="row">
            <div class="col-md-8">
              <div class="form-group row">
                <div class="col-md-2">
                  <%= f.label :id, "Record#" %>
                  <%= f.text_field :id, class: "form-control", :readonly => true %>
                </div>
                <div class="col-md-10">
                  <%= f.label :company_name, "Company Name" %>
                  <%= f.text_field :company_name, class: "form-control" %>
                </div>
              </div>
              <div class="form-group row">
                <div class="col-md-2">
                  <%= f.label :industry, "Industry" %>
                  <%= f.text_field :industry, class: "form-control" %>
                </div>
                <div class="col-md-10">
                  <%= f.label :url, "Homepage (URL)" %>
                  <%= f.text_field :url, class: "form-control" %>
                </div>
              </div>
              <div class="form-group row">
                <div class="col-md-12">
                  <%= f.label :business_description, "Description of Business" %>
                  <%= f.text_area :business_description, rows: 5, class: "form-control", style: "resize : none;" %>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div id="map" class="col-md-12" style='height: 200px; text-align:center;'></div>
            </div>
          </div>

          <hr />
          <h4>Contact Person</h4>
          <div class="form-group row">
            <table class="table table-bordered table-hover table-sm">
              <thead class="thead-light">
                <tr>
                  <th class="col-md-2">First Name</th>
                  <th class="col-md-2">Last Name</th>
                  <th class="col-md-2">Title</th>
                  <th class="col-md-2">Department</th>
                  <th class="col-md-2">Tel#</th>
                  <th class="col-md-2">Email</th>
                </tr>
              </thead>
              <tbody>
                <% @customer.staffs.each do |staff| %>
                  <%= f.fields_for :staffs, staff do |sf| %>
                  <tr>
                    <td class="col-md-2"><%= sf.text_field :first_name, class: "form-control" %></td>
                    <td class="col-md-2"><%= sf.text_field :last_name, class: "form-control" %></td>
                    <td class="col-md-2"><%= sf.text_field :title, class: "form-control" %></td>
                    <td class="col-md-2"><%= sf.text_field :department, class: "form-control" %></td>
                    <td class="col-md-2"><%= sf.text_field :tel, class: "form-control" %></td>
                    <td class="col-md-2"><%= sf.text_field :email, class: "form-control" %></td>
                  </td>
                  <% end %>
                <% end %>
              </tbody>
            </table>
          </div>

          <hr />
          <h4>Billing Information</h4>
          <div class="form-group row">
            <div class="col-md-12">
              <%= f.label :bill_to_street, "Street" %>
              <%= f.text_field :bill_to_street, class: "form-control" %>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-md-3">
              <%= f.label :bill_to_city, "City" %>
              <%= f.text_field :bill_to_city, class: "form-control" %>
            </div>
            <div class="col-md-3">
              <%= f.label :bill_to_state_id, "State" %>
              <%= f.collection_select :bill_to_state_id, State.all, :id, :state_name, {:include_blank => true}, {class: 'form-control'} %>
            </div>
            <div class="col-md-3">
              <%= f.label :bill_to_zip_code, "Zip Code" %>
              <%= f.text_field :bill_to_zip_code, class: "form-control" %>
            </div>
            <div class="col-md-3">
              <%= f.label :bill_to_country_id, "Country" %>
              <%= f.collection_select :bill_to_country_id, Country.all, :id, :country_name, {:include_blank => true}, {class: 'form-control'} %>
            </div>
          </div>

          <hr />
          <h4>Shipping Information</h4>
          <div class="form-group row">
            <div class="col-md-6">
              <%= f.label :ship_to_first_name, "First Name" %>
              <%= f.text_field :ship_to_first_name, class: "form-control" %>
            </div>
            <div class="col-md-6">
              <%= f.label :ship_to_last_name, "Last Name" %>
              <%= f.text_field :ship_to_last_name, class: "form-control" %>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-md-6">
              <%= f.label :ship_to_tel, "Tel#" %>
              <%= f.text_field :ship_to_tel, class: "form-control" %>
            </div>
            <div class="col-md-6">
              <%= f.label :ship_to_email, "Email" %>
              <%= f.text_field :ship_to_email, class: "form-control" %>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-md-12">
              <%= f.label :ship_to_street, "Street" %>
              <%= f.text_field :ship_to_street, class: "form-control" %>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-md-3">
              <%= f.label :ship_to_city, "City" %>
              <%= f.text_field :ship_to_city, class: "form-control" %>
            </div>
            <div class="col-md-3">
              <%= f.label :ship_to_state_id, "State" %>
              <%= f.collection_select :ship_to_state_id, State.all, :id, :state_name, {:include_blank => true}, {class: 'form-control'} %>
            </div>
            <div class="col-md-3">
              <%= f.label :ship_to_zip_code, "Zip Code" %>
              <%= f.text_field :ship_to_zip_code, class: "form-control" %>
            </div>
            <div class="col-md-3">
              <%= f.label :ship_to_country_id, "Country" %>
              <%= f.collection_select :ship_to_country_id, Country.all, :id, :country_name, {:include_blank => true}, {class: 'form-control'} %>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-md-3">
              <%= f.label :latitude, "Latitude" %>
              <%= f.text_field :latitude, class: "form-control" %>
            </div>
            <div class="col-md-3">
              <%= f.label :longitude, "Longitude" %>
              <%= f.text_field :longitude, class: "form-control" %>
            </div>
          </div>
          
          <div class="form-group">
            <div class="col-md-10">
            <%= f.submit "Submit", class: "btn btn-primary btn-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <%= render 'customers/opportunities' %>
</div>


<% if @customer.latitude && @customer.longitude %>
  <script type="text/javascript">
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers(<%=raw @hash2.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });

    function initMap2() {
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: {lat: <%=@customer.latitude%>, lng: <%=@customer.longitude%>},
        mapTypeId: 'terrain'
      });

      var marker = new google.maps.Marker({
          position: new google.maps.LatLng(<%=@customer.latitude%>, <%=@customer.longitude%>),
          map: map,
          icon: '<%=image_path('person.png')%>'
      });
      return map;
    }
    initMap2();
  </script>
<% end %>